(function(d){tinymce.PluginManager.add("tma_annotate",function(a,e){var c;a.addCommand("tma_cmd_hide",function(){c=!c;a.fire("tma_annotatehide",{state:c});body=a.getBody();c?(current=a.getContent(),tinymce.each(a.$("span.annotation"),function(b){a.dom.remove(b,!0)})):body?d(body).html(current):d(body).html("")});a.addButton("tma_annotate",{title:"Create annotation",image:e+"/img/annotation.png",onclick:function(){annotation="";b="#F0E465";node=a.selection.getNode();nodeName=node.nodeName;if("SPAN"==
nodeName&&(nodeDataAnnotation=d(node).attr("data-annotation"),nodeDataStyle=d(node).css("background-color"),nodeDataAnnotation)){annotation=nodeDataAnnotation;b=document.createElement("canvas").getContext("2d");b.strokeStyle=nodeDataStyle;var b=b.strokeStyle}var c=a.selection.getContent();0<c.length?a.windowManager.open({title:"Annotation options",body:[{type:"textbox",name:"annotation",label:"Annotation",value:annotation},{type:"colorpicker",name:"annotationbg",label:"Background color",value:b}],
onsubmit:function(b){if(b.data.annotation){var e=b.data.annotation;d(node).attr("data-annotation")&&a.dom.remove(node);a.selection.setContent('<span class="annotation"  data-annotation="'+e.replace(/"/g,"&quot;")+'" style="background-color:'+b.data.annotationbg+'">'+c+"</span>")}else return a.windowManager.alert("Select the color and the annotation text"),!1}}):a.windowManager.alert("Please select some text for creating an annotation",!1)}});a.addButton("tma_annotatedelete",{title:"Delete annotation",
image:e+"/img/annotation-delete.png",onclick:function(){0<a.selection.getContent().length?(replaceNode=deletionNode=a.selection.getNode(),d(deletionNode).attr("style",""),a.dom.remove(replaceNode,deletionNode)):a.windowManager.alert("Please select the annotation you want to delete")}});a.addButton("tma_annotatehide",{title:"Hide all annotations",image:e+"/img/annotation-hide.png",cmd:"tma_cmd_hide",onPostRender:function(){var b=this;a.on("tma_annotatehide",function(a){b.active(a.state)})}})})})(jQuery);